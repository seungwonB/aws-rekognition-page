<!doctype html>
<html lang="en">

<head profile="http://www.w3.org/2005/10/profile">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <title>인더 픽처</title>
    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    {#
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    #}
    <style>
        * {
            font-family: 'Jua', sans-serif;
        }


        .container {
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            margin: 0px auto;
            max-width: 400px;
            padding: 0vh 16px;
            padding-top: 10px;
        }

        .btn_div {
            border-radius: 10px;
            position: relative;
            width: 70vw;
            height: 20vh;
            background-color: black;
            display: table;
            margin-top: 20px;
        }

        .btn_camera:hover {
            color: black;
            transition: color 0.3s;
            font-size: 4.2em;
            text-shadow: 2px 2px 2px gray;
        }

        .btn_camera {
            background-color: #00b531;
            color: white;
            width: 70vw;
            height: 20vh;
            border-radius: 6px;
            font-size: 4em;
            text-align: center;
            vertical-align: middle;
            display: table-cell;
            font-weight: bold;
        }

        #cameraFileInput {
            display: none;
        }

        #pictureFromCamera {
            width: 300px;
            margin-top: 16px;
        }

        .posting-box > .custom-file {
            margin-bottom: 20px;
        }

        #s3upload {
            font-size: 2.0em;
            width: 200px;
            height: 10vh;
        }

        #audio {
            display: none;
        }
    </style>
    <script>
        $(document).ready(function () {
            bsCustomFileInput.init()
            listing()
        })

        function listing() {
            $.ajax({
                type: "GET",
                url: "/diary",
                data: {},
                success: function (response) {
                    let diaries = response['all_diary']
                    for (let i = 0; i < diaries.length; i++) {
                        let title = diaries[i]['title']
                        let content = diaries[i]['content']
                        let file = diaries[i]['file']
                        let time = diaries[i]['time']

                        let temp_html = `<div class="card">
                                            <img src="../static/${file}" class="card-img-top">
                                            <div class="card-body">
                                                <h5 class="card-title">${title}</h5>
                                                <p class="card-text">${content}</p>
                                                <p class="card-time" style="color:gray; font-size:10px;">${time}</p>
                                            </div>
                                        </div>`
                        $('#cards-box').append(temp_html)
                    }
                }
            })
        }

        function getText() {
            let bucketName = 'seungwonbucket1'
            let files = document.getElementById('cameraFileInput').files;
            let file = files[0];
            let fileName = file.name;
            let filePath = fileName;

            // {#let fileUrl = 'https://' + bucketRegion + '.amazonaws.com/' + filePath;#}

            // {#let file = $('#cameraFileInput')[0].files[0]#}
            let form_data = new FormData()
            // {#form_data.append("content_give", content)#}
            form_data.append("content_give", filePath)
            form_data.append("file_give", bucketName)

            $.ajax({
                type: "POST",
                url: "/reko",
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    alert(response["msg"])
                    // {#window.location.reload()#}
                }
            });
        }
    </script>


    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.24.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        //Bucket Configurations
        var bucketName = 'seungwonbucket1';
        var bucketRegion = 'ap-northeast-2';
        var IdentityPoolId = 'ap-northeast-2:9ab049a5-9ef5-4d03-ad3e-dc543c72f333';

        AWS.config.update({
            region: bucketRegion,
            credentials: new AWS.CognitoIdentityCredentials({
                IdentityPoolId: IdentityPoolId
            })
        });

        var s3 = new AWS.S3({
            apiVersion: '2006-03-01',
            params: {Bucket: bucketName}
        });
    </script>
    <script type="text/javascript">
        function s3upload() {
            var files = document.getElementById('cameraFileInput').files;
            if (files) {
                var file = files[0];
                var fileName = file.name;
                var filePath = fileName;
                var fileUrl = 'https://' + bucketRegion + '.amazonaws.com/' + filePath;
                s3.upload({
                    Key: filePath,
                    Body: file,
                    ACL: 'public-read'
                }, function (err, data) {
                    if (err) {
                        reject('error');
                    }
                    // {#alert('Successfully Uploaded!');#}
                }).on('httpUploadProgress', function (progress) {
                    var uploaded = parseInt((progress.loaded * 100) / progress.total);
                    $("progress").attr('value', uploaded);
                });
            }

            let bucketName = 'seungwonbucket1'
            // {#let files = document.getElementById('cameraFileInput').files;#}
            // {#let file = files[0];#}
            // {#let fileName = file.name;#}
            // {#let filePath = fileName;#}

            // {#let fileUrl = 'https://' + bucketRegion + '.amazonaws.com/' + filePath;#}

            // {#let file = $('#cameraFileInput')[0].files[0]#}
            let form_data = new FormData()
            // {#form_data.append("content_give", content)#}
            form_data.append("content_give", filePath)
            form_data.append("file_give", bucketName)

            $.ajax({
                type: "POST",
                url: "/reko",
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    let res = response['msg'];
                    // let res2 = response['msg2'];
                    let temp_html = `<div>${res}</div>`
                    // let textEntry = document.getElementById('textEntry').val();
                    // console.log(textEntry);
                    $('#resultText').append(temp_html)
                    $('#textEntry').val(res);
                    // alert(response["msg"])
                    // {#window.location.reload()#}
                }
            });
        };
    </script>

</head>

<body>
<div class="container">
    <div class="container camera">
        <label for="cameraFileInput">
            <!-- 사진촬영 -->
            <div class="btn_div">
                <span class="btn_camera">인물</span>
            </div>
            <input type="file" id="cameraFileInput" accept="image/" capture="environment">
        </label>
        <div id="resultText"></div>
        <img id="pictureFromCamera"/>
        <script>
            var camera = document.getElementById('cameraFileInput');
            var frame = document.getElementById('pictureFromCamera');

            camera.addEventListener('change', function (e) {
                var file = e.target.files[0];
                frame.src = URL.createObjectURL(file);
            });
        </script>

        <!-- 업로드 버튼 -->
        <p></p>
        <button onclick="s3upload()" id="s3upload">분석하기v1</button>
        <p></p>
        <!--Polly-->
        <div id="textToSynth">
            <input autofocus size="23" type="text" id="textEntry" value="안녕"/>
            <button class="btn default" onClick="speakText()">Synthesize</button>
            <p id="result">Enter text above then click Synthesize</p>
        </div>
        <audio id="audioPlayback" autoplay>
            <source id="audioSource" type="audio/mp3" src="">
        </audio>
        <script src="https://sdk.amazonaws.com/js/aws-sdk-2.410.0.min.js"></script>
        <script type="text/javascript">

            // Initialize the Amazon Cognito credentials provider
            AWS.config.region = 'ap-northeast-2';
            AWS.config.credentials = new AWS.CognitoIdentityCredentials(
                {IdentityPoolId: 'ap-northeast-2:f14709fa-69d5-4a7c-b80a-188591d81cba'});

            // Function invoked by button click
            function speakText() {
                // Create the JSON parameters for getSynthesizeSpeechUrl
                var speechParams = {
                    OutputFormat: "mp3",
                    SampleRate: "16000",
                    Text: "",
                    TextType: "text",
                    VoiceId: "Seoyeon"
                };
                speechParams.Text = document.getElementById("textEntry").value;

                // Create the Polly service object and presigner object
                var polly = new AWS.Polly({apiVersion: '2016-06-10'});
                var signer = new AWS.Polly.Presigner(speechParams, polly)

                // Create presigned URL of synthesized speech file
                signer.getSynthesizeSpeechUrl(speechParams, function (error, url) {
                    if (error) {
                        document.getElementById('result').innerHTML = error;
                    } else {
                        document.getElementById('audioSource').src = url;
                        document.getElementById('audioPlayback').load();
                        document.getElementById('result').innerHTML = "Speech ready to play.";
                    }
                });
            }
        </script>
    </div>
</div>

</body>
</html>
